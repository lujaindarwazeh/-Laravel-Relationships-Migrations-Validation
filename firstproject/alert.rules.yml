groups:
  - name: service-alerts
    rules:
      - alert: MySQLDown
        expr: probe_success{job="mysql_blackbox"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "MySQL is DOWN"
          description: "The MySQL server on {{ $labels.instance }} is not reachable for more than 1 minute."

      - alert: RedisDown
        expr: probe_success{job="redis_blackbox"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Redis is DOWN"
          description: "The Redis server on {{ $labels.instance }} is not reachable for more than 1 minute."

      - alert: KafkaDown
        expr: probe_success{job="kafka_blackbox"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Kafka is DOWN"
          description: "The Kafka broker on {{ $labels.instance }} is not reachable for more than 1 minute."

      # - alert: SlowRequest
      #   expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[1m])) > 2
      #   for: 1m
      #   labels:
      #     severity: critical
      #   annotations:
      #     summary: "Slow request detected"
      #     description: "The 95th percentile of request duration is over 2s for the last 1 minute."

      - alert: LaravelHttpSlow
        expr: probe_duration_seconds{job="laravel_http"} > 9
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Laravel HTTP request is slow"
          description: "Blackbox probe took more than 9s for {{ $labels.instance}}"